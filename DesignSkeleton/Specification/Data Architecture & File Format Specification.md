# ğŸ“˜ Data Architecture & File Format Specification

---

## v0.0

### 1. Overviewï¼ˆæ€»è§ˆï¼‰

æœ¬é¡¹ç›®çš„æ•°æ®ä¸é…ç½®ä½“ç³»ç”±å››ç±»æ–‡ä»¶æ„æˆï¼š

| å±‚çº§                                  | æ–‡ä»¶ç±»å‹                  | èŒè´£ï¼ˆä¸€å¥è¯ï¼‰                                          |
| ------------------------------------- | ------------------------- | ------------------------------------------------------- |
| æ•°æ®ä¸»æºï¼ˆData Source of Truthï¼‰      | Parquet / Parquet Dataset | é«˜é€Ÿ I/Oã€å›ºå®š schemaã€ä½œä¸ºä¸‹æ¸¸åˆ†æçš„æ ¸å¿ƒæ•°æ®ç»“æ„       |
| å¯è¯»å±•ç¤ºå±‚ï¼ˆHuman-Readable Layerï¼‰    | TSVï¼ˆåˆ¶è¡¨ç¬¦æ–‡æœ¬ï¼‰         | äººå·¥æŸ¥çœ‹ã€å¿«é€Ÿæ ¡éªŒã€ç»˜å›¾è¾“å…¥ï¼Œå°æ–‡ä»¶åœºæ™¯æœ€ä½³            |
| è¯­ä¹‰çœŸæºï¼ˆSemantic Source of Truthï¼‰  | configs.yaml              | å†³å®š pipeline è¡Œä¸ºçš„å”¯ä¸€é…ç½®çœŸæº                        |
| å…¥å£æ˜ å°„ä¸æ‘˜è¦ï¼ˆManifest & Snapshotï¼‰ | meta.json                 | ç”¨äºè·¨è¯­è¨€æ¨¡å—åŠ è½½ out ç›®å½•çš„ç´¢å¼•ä¸æ‘˜è¦ï¼Œä¸å‚ä¸åˆ†æé€»è¾‘ |

è¿™å››è€…å½¢æˆäº†ä¸€ä¸ªæ¸…æ™°çš„èŒè´£åˆ†å±‚ä½“ç³»ï¼š

```mermaid
graph TD
    A[meta.json<br>Manifest & Summary]
    B[configs.yaml<br>Semantic True Conf]
    C[Parquet<br>Key Player Analysis Matrix]
    D[TSV<br>Visualization & Verification]

    A --> B
    B --> C
    C --> D
```

---

### 2. Parquet / Parquet Dataset

#### 2.1 éœ€æ±‚æ¥æº

- éœ€è¦åœ¨åˆ†æé˜¶æ®µè¿›è¡Œé«˜é¢‘è¯»å†™ï¼ˆå¦‚ Normalize / Filter / Diff / Enrichmentï¼‰ï¼›
- è¡Œæ•°/åˆ—æ•°è¾ƒå¤§ï¼ˆè›‹ç™½çŸ©é˜µå‡ å MB åˆ°å‡ ç™¾ MBï¼‰ï¼›
- å¸Œæœ›å‡å°‘æ–‡æœ¬è§£æå¼€é”€ï¼›
- å¸Œæœ›æ”¯æŒ schema ç¨³å®šæ€§ï¼ˆå­—æ®µç±»å‹ã€å­—æ®µåï¼‰ï¼›
- å¸Œæœ›å¯è¢«å¤šè¯­è¨€ï¼ˆPython, R, Rust, Goï¼‰ä¸€è‡´è¯»å†™ã€‚

#### 2.2 è®¾è®¡åˆè¡·

- ä½œä¸ºåˆ†æçš„æ ¸å¿ƒæ•°æ®è½½ä½“ï¼›
- ä½œä¸ºå¯å¤è·‘ã€å¯æŒä¹…åŒ–çš„ç¨³å®šæ ¼å¼ï¼›
- ä¿è¯æ•°æ®ç±»å‹ä¸€è‡´ã€æ— æŸã€å¿«é€Ÿã€åŠç»“æ„åŒ–ã€‚

#### 2.3 é€‰æ‹©ç†ç”±ï¼ˆä¸ºä»€ä¹ˆé€‰ Parquet è€Œä¸æ˜¯ CSV/TSV/HDF5ï¼‰

- åˆ—å¼å­˜å‚¨ï¼Œé«˜æ•ˆç­›é€‰ï¼ˆfilterï¼‰ã€èšåˆï¼ˆgroup-byï¼‰ï¼›
- ç±»å‹æ˜ç¡®ï¼Œé¿å…å­—ç¬¦ä¸²æ¨æ–­ï¼›
- å‹ç¼©æ•ˆæœå¥½ï¼ˆZSTD / Snappyï¼‰ï¼›
- æ”¯æŒ Datasetï¼ˆå¤šæ–‡ä»¶åˆ†åŒºï¼‰ï¼Œé€‚åˆå¤§è§„æ¨¡æ•°æ®ï¼›
- è·¨è¯­è¨€æ”¯æŒæœ€å¥½ï¼ˆpyarrowã€polarsã€arrow-rsã€Sparkï¼‰ã€‚

#### 2.4 å…¸å‹ä½¿ç”¨åœºæ™¯

- ä¿¡æ¯è¡¨ï¼š`info-samples.parquet` / `info-contrasts.parquet`
- å®šé‡çŸ©é˜µï¼šprotein / peptide intensity matrix
- annotation æ˜ å°„è¡¨
- large intermediate tablesï¼ˆnormalized, imputed, filteredï¼‰

#### 2.5 æ³¨æ„äº‹é¡¹

- å­—æ®µç±»å‹å¿…é¡»å›ºå®šï¼›
- ç¦æ­¢å­˜å‚¨â€œè¡¨ç¤ºè¯­ä¹‰çš„é…ç½®â€ï¼ˆå¦‚ cutoffï¼‰ï¼Œé‚£äº›å±äº YAMLï¼›
- ç¦æ­¢æ··å…¥å¯å˜ç»“æ„ï¼ˆlist/structï¼‰ï¼Œé™¤é schema ç¨³å®šï¼›
- æ¨èå‹ç¼©ï¼š`zstd(level=3~5)`ã€‚

#### 2.6 Anti-patternï¼ˆç»ä¸èƒ½è¿™ä¹ˆç”¨ï¼‰

âŒ æŠŠ parquet å½“é…ç½®æ–‡ä»¶
 âŒ åœ¨ parquet ä¸­éšå«åˆ†æå‚æ•°ï¼ˆå¦‚ normalization methodï¼‰
 âŒ æ‰‹åŠ¨ç¼–è¾‘ parquetï¼ˆä¸å¯è¡Œï¼‰

---

### 3. TSVï¼ˆåˆ¶è¡¨ç¬¦æ–‡æœ¬æ–‡ä»¶ï¼‰

#### 3.1 éœ€æ±‚æ¥æº

- å¯è¯»æ€§å¼ºï¼Œé€‚åˆäººå·¥å¿«é€Ÿæ ¡éªŒï¼›
- ç»˜å›¾è„šæœ¬ï¼ˆR/ggplot2ã€Python/Seabornï¼‰ç›´æ¥ ingestï¼›
- æ–‡ä»¶å°ºå¯¸é€šå¸¸å°ï¼ˆå‡ ç™¾ KBï½å‡  MBï¼‰ï¼›
- ç ”å‘/è´¨æ£€äººå‘˜éœ€è¦æ‰‹åŠ¨æ£€æŸ¥ã€‚

#### 3.2 è®¾è®¡åˆè¡·

- ä½œä¸ºâ€œäººæœºç•Œé¢å±‚ï¼ˆHuman Interface Layerï¼‰â€ï¼›
- ç»˜å›¾ä¸æ˜¯ I/O å¯†é›†å‹ï¼Œä¸éœ€è¦ parquet çš„å¤æ‚æ€§ï¼›
- ç”¨ä½œå¿«é€Ÿ debugã€ç»“æœå±•ç¤ºã€‚

#### 3.3 é€‰æ‹©ç†ç”±ï¼ˆä¸ºä»€ä¹ˆä¸é€‰ CSV/Excelï¼‰

- CSV æ˜“å—é€—å·å¹²æ‰°ï¼Œä¸å¦‚ TSV ç¨³ï¼›
- Excel ä¸å¯è¿½è¸ª diffï¼Œä¸åˆ©äºç‰ˆæœ¬æ§åˆ¶ï¼Œæ–‡ä»¶ä½“ç§¯å¤§ï¼›
- TSV è¡Œä¸ºå¯é¢„æµ‹ï¼Œè·¨è¯­è¨€å…¼å®¹å¥½ã€‚

#### 3.4 ä½¿ç”¨åœºæ™¯

- å„ç±» plotting æ•°æ®ï¼ˆå„ç±» input.tsvï¼‰
- info-samples.tsv / info-contrasts.tsvï¼ˆäººç±»å¯è¯»ç‰ˆæœ¬ï¼‰
- ä¸Šä¸‹æ¸¸ç ”å‘äº¤æµæ–‡ä»¶

#### 3.5 æ³¨æ„äº‹é¡¹

- å­—æ®µç±»å‹ä¸¢å¤±ï¼Œè¯·ä½¿ç”¨ parquet ä½œä¸ºä¸¥è‚ƒåˆ†æè¾“å…¥ï¼›
- åªä¿è¯å¯è¯»ï¼Œä¸ä¿è¯ç±»å‹è¯­ä¹‰ï¼›
- å»ºè®®å¯¹åˆ—åå’Œç¼–ç è¿›è¡Œç»Ÿä¸€è§„èŒƒï¼ˆSnakeCase / PascalCaseï¼‰ã€‚

#### 3.6 Anti-pattern

âŒ ç”¨ TSV æ›¿ä»£ Parquet ä½œä¸ºåˆ†æä¸»åŠ›æ–‡ä»¶
 âŒ æŠŠé«˜ç»´æ•°æ®ï¼ˆ>10 MBï¼‰æ”¾ TSV å¯¼è‡´ I/O å»¶è¿Ÿ

---

### 4. configs.yaml

#### 4.1 è§’è‰²å®šä¹‰ï¼šSemantic Source of Truthï¼ˆè¯­ä¹‰çœŸæºï¼‰

> configs.yaml æ˜¯å”¯ä¸€å†³å®š pipeline è¡Œä¸ºçš„é…ç½®æ¥æºã€‚
> ä»»ä½•æ¶‰åŠâ€œåˆ†æé€»è¾‘â€çš„å†…å®¹å¿…é¡»ä»¥ YAML ä¸ºå‡†ã€‚

#### 4.2 éœ€æ±‚æ¥æº

- å¹³å°å·®å¼‚ï¼ˆMQ / DIA-NNï¼‰å†³å®šè¯»å–çŸ©é˜µæ–¹å¼ï¼›
- TMT éœ€è¦ reference channelã€normalization ç­–ç•¥ï¼›
- ç‰©ç§ / reference ä¿¡æ¯å½±å“æ³¨é‡Šæµç¨‹ï¼›
- é¡¹ç›®å…ƒæ•°æ®ï¼ˆå®¢æˆ·ç¼–å·ã€é¡¹ç›®åç§°ï¼‰å½±å“æŠ¥å‘Šï¼›
- å°†æ¥ä¼šåŠ å…¥åˆ†æå‚æ•°ï¼ˆcutoffã€imputeã€normalizationï¼‰ã€‚

#### 4.3 è®¾è®¡åˆè¡·

- å­˜å‚¨â€œå½±å“åˆ†æè¯­ä¹‰çš„æ‰€æœ‰å‚æ•°â€ï¼›
- äººç±»å¯è¯»å¯ç¼–è¾‘ï¼›
- ä¾¿äºå®¡è®¡ã€å¤è·‘ã€ç‰ˆæœ¬æ§åˆ¶ï¼›
- ä½œä¸ºæ•´ä¸ªé¡¹ç›®çš„â€œä¸–ç•Œè§‚å®šä¹‰â€ã€‚

#### 4.4 é€‰æ‹©ç†ç”±ï¼ˆä¸ºä»€ä¹ˆ YAML è€Œé JSON/TOMLï¼‰

- YAML æ›´é€‚åˆéæŠ€æœ¯ç”¨æˆ·é˜…è¯»ï¼›
- æ³¨é‡Šæ”¯æŒå¥½ï¼›
- ç»“æ„æ¸…æ™°ï¼Œå›¢é˜Ÿå¯å¿«é€Ÿé˜…è¯»ï¼›
- JSON ä¸æ”¯æŒæ³¨é‡Šï¼Œä¸åˆ©äºå®¡è®¡ï¼›
- ç›¸æ¯”äº `toml` ï¼Œ`yaml` çš„é€‚ç”¨èŒƒå›´ã€å¹³å°æ”¯æŒæ›´å¹¿æ³›ã€‚

#### 4.5 ä½¿ç”¨åœºæ™¯

- ä»»ä½•ä¼šå½±å“åˆ†ææµç¨‹çš„æ¨¡å—å‡å¿…é¡»è¯»å–ï¼š
  - Normalize / Filter
  - Diff / Enrichment
  - Heatmap
  - QC / Summary
  - WDL / Nextflow orchestration

#### 4.6 æ³¨æ„äº‹é¡¹

- configs.yaml ä¸èƒ½ç¼ºå¤±ï¼›
- ä¸èƒ½è¢« meta.json æ›¿ä»£ï¼›
- ä¸èƒ½åŒ…å«è¿‡å¤§åµŒå¥—ç»“æ„ï¼ˆä¿æŒæœ€ä½å¤æ‚æ€§ï¼‰ï¼›
- æ‰€æœ‰å‚æ•°å¿…é¡»ç¨³å®šå¯è¿½è¸ªã€‚

#### 4.7 Anti-pattern

âŒ æŠŠåˆ†æé€»è¾‘ç¡¬ç¼–ç åˆ° Python / R ä¸­ï¼Œè€Œä¸æ˜¯å†™åœ¨ YAML
 âŒ åœ¨ meta.json ä¸­é‡å¤å¹¶æ‰©å±• YAML å†…å®¹
 âŒ ä½¿ç”¨ JSON ä½œä¸ºé…ç½®çœŸæºï¼ˆå›¢é˜Ÿä¸æ˜“è¯»ï¼‰

---

### 5. meta.json

#### 5.1 è§’è‰²å®šä¹‰ï¼šå…¥å£ç´¢å¼• & æ‘˜è¦å¿«ç…§ï¼ˆManifest & Snapshotï¼‰

> meta.json å¹¶éé…ç½®æºï¼Œä¸å‚ä¸å†³å®šåˆ†æé€»è¾‘ã€‚
> å®ƒå­˜åœ¨çš„å”¯ä¸€ç›®çš„ï¼šè®©ä»»ä½•è¯­è¨€/æ¨¡å—èƒ½åªå‡­ /out ç›®å½•å¯åŠ¨æ•´ä¸ªé¡¹ç›®ã€‚

#### 5.2 æ ¸å¿ƒèŒè´£

- ç»Ÿä¸€å…¥å£ï¼ˆentrypointï¼‰ï¼›
- å¿«é€Ÿé¢„è§ˆï¼ˆn_samples, n_contrasts, platformï¼‰ï¼›
- æ–‡ä»¶ç´¢å¼•ï¼ˆmanifestï¼‰ï¼š
  - info-samples.parquet
  - info-contrasts.parquet
  - configs.yaml

#### 5.3 éœ€æ±‚æ¥æº

- è·¨è¯­è¨€ï¼ˆPython/Rï¼‰ç»Ÿä¸€åŠ è½½æ¥å£ï¼›
- éœ€è¦â€œself-describing directoryâ€ï¼›
- Dashboard / Web å‰ç«¯éœ€è¦æ‘˜è¦ä¿¡æ¯ï¼›
- CLI å·¥å…·éœ€è¦å¿«é€Ÿæ£€æŸ¥è¾“å‡ºæƒ…å†µã€‚

#### 5.4 è®¾è®¡åˆè¡·

- ä¸å­˜æ”¾ä¸šåŠ¡è¯­ä¹‰ï¼›
- ä¸æ‰©å±•é…ç½®å†…å®¹ï¼›
- å¯ä» YAML + parquet å®Œå…¨é‡å»ºã€‚

#### 5.5 ä¸ºä»€ä¹ˆé€‰æ‹© JSON

- å‰ç«¯ã€åç«¯é€šç”¨ï¼›
- æ— éœ€é¢å¤–ä¾èµ–ï¼›
- æ˜“è¢«å„ç§è¯­è¨€è§£æï¼›
- schema å‹åŠ›å¯æ§ã€‚

#### 5.6 æ³¨æ„äº‹é¡¹

- ä¸èƒ½ä¸ configs.yaml å½¢æˆå†²çªï¼›
- ä¸èƒ½åŒ…å«ä¼šæ”¹å˜åˆ†æç»“æœçš„å­—æ®µï¼›
- ä»…ç”¨äºå…¥å£å¯¼èˆªä¸æ‘˜è¦ã€‚

#### 5.7 Anti-pattern

âŒ åœ¨ meta.json ä¸­å­˜å‚¨ cutoffã€normalization ç­‰åˆ†æå‚æ•°
 âŒ æŠŠ meta.json å½“ä¸»é…ç½®æ–‡ä»¶
 âŒ åœ¨ä¸åŒæ¨¡å—é‡Œæ‰‹å†™ meta.json å¯¼è‡´ä¸ä¸€è‡´

---

### 6. å››è€…çš„å…³ç³»æ€»ç»“ï¼ˆé‡ç‚¹ï¼‰

| æ–‡ä»¶ç±»å‹     | æ˜¯å¦å‚ä¸åˆ†æé€»è¾‘     | æ˜¯å¦äººå·¥å¯è¯»   | æ˜¯å¦äººæ‰‹å¯ç¼–è¾‘ | æ˜¯å¦è·¨æ¨¡å—å…¥å£     | æ˜¯å¦ä¸»æ•°æ®æº |
| ------------ | -------------------- | -------------- | -------------- | ------------------ | ------------ |
| configs.yaml | âœ”âœ”âœ”ï¼ˆä¸»è¦ä¾æ®ï¼‰   | âœ”             | âœ”             | âœ”                 | âœ˜           |
| meta.json    | âœ˜ï¼ˆä¸èƒ½å‚ä¸ï¼‰       | âœ”             | âœ˜             | âœ”âœ”âœ”ï¼ˆå”¯ä¸€å…¥å£ï¼‰ | âœ˜           |
| parquet      | âœ”âœ”âœ”ï¼ˆä¸»è¦æ•°æ®æºï¼‰ | éƒ¨åˆ†ï¼ˆéœ€å·¥å…·ï¼‰ | âœ˜             | âœ”                 | âœ”           |
| tsv          | âœ˜ï¼ˆä»…å±•ç¤ºï¼‰         | âœ”âœ”âœ”         | âœ”âœ”âœ”         | å¯é€‰               | âœ˜           |

æ€»ç»“ä¸€å¥è¯ï¼š

> é…ç½®çœ‹ YAMLï¼Œæ•°æ®çœ‹ Parquetï¼Œç»˜å›¾çœ‹ TSVï¼Œå…¥å£çœ‹ JSONã€‚
> å››è€…æ²¡æœ‰æ›¿ä»£å…³ç³»ï¼Œåªæ˜¯èŒè´£ä¸åŒã€‚

---

### 7. Pipeline åŠ è½½æµç¨‹ï¼ˆå»ºè®®å®ç°ï¼‰

```python
def load_project(dir_out: Path):
    meta = load_meta(dir_out)                # æŸ¥ indexã€æŸ¥æ–‡ä»¶å
    cfg = load_yaml(dir_out/meta['Files']['ConfigsYaml'])   # çœŸæº
    df_samples   = load_parquet(dir_out/meta['Files']['InfoSamplesParquet'])
    df_contrasts = load_parquet(dir_out/meta['Files']['InfoContrastsParquet'])
    return cfg, df_samples, df_contrasts
```

æ‰€æœ‰æ ¸å¿ƒç®—æ³•ï¼š

- ä¸è¯» meta.json
- åªè¯» cfgï¼ˆyamlï¼‰å’Œ df_xxxï¼ˆdataï¼‰

å¹²å‡€ã€ç¨³å®šã€æ˜“æµ‹è¯•ã€‚

---

### 8. Usage Examplesï¼ˆä½¿ç”¨ç¤ºä¾‹ï¼‰

æœ¬èŠ‚æ¼”ç¤ºï¼š

1. intake æ¨¡å—å¦‚ä½•è¾“å‡º `configs.yaml` ä¸ `meta.json`
2. è¾“å‡ºæ–‡ä»¶æ¨èå†…å®¹ç¤ºä¾‹
3. ä¸‹æ¸¸æ¨¡å—å¦‚ä½•è¯»å–å®ƒä»¬å¹¶è¿›å…¥åˆ†ææµç¨‹

---

#### 8.1 ä¸Šæ¸¸ intake è¾“å‡ºç¤ºä¾‹

å‡è®¾ intake è¾“å…¥ï¼š

```bash
in/
  â”œâ”€â”€ sample_info.json
  â”œâ”€â”€ compare_group_info.json
  â”œâ”€â”€ project_info.json
  â”œâ”€â”€ config_mqpar.xml   ï¼ˆæˆ– config_diann.jsonï¼‰
  â””â”€â”€ options.xlsx
```

intake è¾“å‡ºæ–‡ä»¶å¤¹ï¼š

```bash
out/
  â”œâ”€â”€ info-samples.parquet
  â”œâ”€â”€ info-samples.tsv
  â”œâ”€â”€ info-contrasts.parquet
  â”œâ”€â”€ info-contrasts.tsv
  â”œâ”€â”€ configs.yaml
  â””â”€â”€ meta.json
```

---

#### 8.2 ç¤ºä¾‹ï¼šconfigs.yamlï¼ˆè¯­ä¹‰çœŸæºï¼‰

```yaml
platform:
  Engine: DIA-NN
  Version: "2.2.0"
  FilenamesFasta:
    - Bovine_UP000009136_2025_08_04.fasta
  FilenamesLibrary: []
  FilenameProteins: report.pg_matrix.tsv
  FilenamePeptides: report.pr_matrix.tsv

project:
  ProjectCode: SNWD042825100601
  ProjectName: "Astral DIA æ ‡å‡†è›‹ç™½ç»„"
  CustomerName: "å­™å¾·é¹"
  CustomerUnit: "å±±ä¸œå¸ˆèŒƒå¤§å­¦"

ref:
  Name: Bos taurus (Bovine)
  Version: v1
  DownloadUrl: https://www.uniprot.org/proteomes/UP000009136
```

> æ³¨æ„ï¼šconfigs.yaml çš„ç‰¹ç‚¹ï¼š
>
> - åªåŒ…å«â€œåˆ†æè¯­ä¹‰â€ç›¸å…³çš„å†…å®¹ï¼›
> - æ‰€æœ‰å€¼å¯è¢« pipeline å†æ¬¡è¯»å–å†³å®šè¡Œä¸ºï¼›
> - ä¸å­˜å‚¨ runtime ä¿¡æ¯ï¼Œä¸å­˜å‚¨æ‘˜è¦ï¼Œä¸å­˜å‚¨æ–‡ä»¶è·¯å¾„ã€‚

---

#### 8.3 ç¤ºä¾‹ï¼šmeta.jsonï¼ˆå…¥å£ç´¢å¼• + æ‘˜è¦ï¼‰

```json
{
  "SchemaVersion": "1.0.0",
  "IntakeVersion": "0.2.1",
  "RunAt": "2025-12-11T11:35:02+08:00",

  "DirIn": "/project/proteomics/tests/test_a/in",
  "DirOut": "/project/proteomics/tests/test_a/out",

  "Platform": {
    "Engine": "DIA-NN",
    "Version": "2.2.0"
  },

  "Project": {
    "ProjectCode": "SNWD042825100601",
    "ProjectName": "Astral DIA æ ‡å‡†è›‹ç™½ç»„"
  },

  "Files": {
    "ConfigsYaml": "configs.yaml",
    "InfoSamplesParquet": "info-samples.parquet",
    "InfoContrastsParquet": "info-contrasts.parquet",
    "InfoSamplesTsv": "info-samples.tsv",
    "InfoContrastsTsv": "info-contrasts.tsv"
  },

  "Samples": {
    "NSamples": 10,
    "NGroups": 2
  },

  "Contrasts": {
    "NTotal": 3,
    "NTTest": 1,
    "NAnova": 2
  }
}
```

> meta.json ç‰¹ç‚¹ï¼š
>
> - ä¸åŒ…å«è¯­ä¹‰ä¿¡æ¯ï¼ˆæ¯”å¦‚ FASTA è·¯å¾„ã€TMT é…ç½®ç­‰ï¼‰ï¼›
> - åªç”¨äºâ€œæ‰¾åˆ°æ–‡ä»¶ã€çŸ¥é“æ•°é‡ã€çŸ¥é“å¹³å°å±•ç¤ºä¿¡æ¯â€ï¼›
> - æ°¸è¿œå¯ä» `configs.yaml + parquet` é‡å»ºã€‚

---

#### 8.4 ä¸‹æ¸¸ï¼šè¯»å– meta.json ä¸ configs.yaml çš„æ ‡å‡†æ–¹å¼

ä¸‹é¢å±•ç¤ºæ¨èçš„åˆ†å±‚åŠ è½½æ–¹å¼ï¼š

---

##### ï¼ˆ1ï¼‰é¡¶å±‚å…¥å£ï¼šload_project()

```python
import json
import yaml
import polars as pl
from pathlib import Path


def load_project(dir_out: Path):
    """Load a completed proteomics project using meta.json + configs.yaml."""

    # 1. load meta.jsonï¼ˆå¯é€‰ï¼Œä½†å¼ºçƒˆå»ºè®®ï¼‰
    file_meta = dir_out / "meta.json"
    if file_meta.exists():
        meta = json.loads(file_meta.read_text())
        files = meta["Files"]
    else:
        # fallback â€” ä¸å»ºè®®é•¿æœŸä½¿ç”¨ï¼Œä½†å…¼å®¹å†å²
        files = {
            "ConfigsYaml": "configs.yaml",
            "InfoSamplesParquet": "info-samples.parquet",
            "InfoContrastsParquet": "info-contrasts.parquet",
        }
        meta = None

    ## 2. load configs.yamlï¼ˆå¿…é¡»ï¼‰
    cfg = yaml.safe_load((dir_out / files["ConfigsYaml"]).read_text())

    ## 3. load Parquet dataï¼ˆåˆ†æä¸»åŠ›ï¼‰
    df_samples   = pl.read_parquet(dir_out / files["InfoSamplesParquet"])
    df_contrasts = pl.read_parquet(dir_out / files["InfoContrastsParquet"])

    return cfg, df_samples, df_contrasts, meta
```

---

##### ï¼ˆ2ï¼‰ä¸‹æ¸¸åˆ†ææ¨¡å—ç¤ºä¾‹

##### å·®å¼‚åˆ†æ diff

```python
def run_diff(cfg, df_samples, df_contrasts, df_matrix):
    engine = cfg["platform"]["Engine"]

    if engine == "DIA-NN":
        # ä½¿ç”¨ DIA-NN è§„åˆ™è¯»å–çŸ©é˜µ
        pass
    else:
        # MaxQuant è§„åˆ™
        pass

    # ä¾ç…§ df_samples å’Œ df_contrasts éå†åˆ†æ
    ...
```

ç‰¹ç‚¹ï¼š

- diff å‡½æ•°ä¸å†éœ€è¦ meta.jsonï¼›
- å®ƒåªä¾èµ– â€œè¯­ä¹‰é…ç½®â€ï¼ˆyamlï¼‰+ â€œæ•°æ®â€ï¼ˆparquetï¼‰
  â†’ ç¨³å®šã€å¯æµ‹ã€æ— å‰¯ä½œç”¨ã€‚

---

###### ï¼ˆ3ï¼‰ç»˜å›¾æ¨¡å—ç¤ºä¾‹ï¼ˆä½¿ç”¨ TSV è¾“å…¥ï¼‰

æˆ‘ä»¬æ¨èç»˜å›¾ä½¿ç”¨ TSVï¼Œå› ä¸ºï¼š

- äººå·¥å¯è¯»å¯ç¼–è¾‘ï¼›
- R/ggplot2 å…¼å®¹æ€§æ›´å¥½ï¼›
- ä½“é‡å°ï¼ˆç»˜å›¾ä¸éœ€è¦å¤§çŸ©é˜µï¼‰ã€‚

```r
df <- read.delim("out/info-samples.tsv")
ggplot(df, aes(Group, SampleAlias)) + 
    geom_point()
```

---

#### 8.5 æ€»ç»“ï¼šä¸‹æ¸¸åˆ°åº•è¯¥è¯»ä»€ä¹ˆï¼Ÿ

| åŠŸèƒ½                                          | è¯»å– YAMLï¼Ÿ | è¯»å– meta.jsonï¼Ÿ | è¯»å– Parquetï¼Ÿ | è¯»å– TSVï¼Ÿ |
| --------------------------------------------- | ----------- | ---------------- | -------------- | ---------- |
| Pipeline å…¥å£                                 | âœ”          | âœ”               | âœ”             | å¯é€‰       |
| åˆ†æä¸»é€»è¾‘ï¼ˆdiff, normalization, enrichmentï¼‰ | âœ”ï¼ˆå¿…é¡»ï¼‰  | âœ˜               | âœ”ï¼ˆå¿…é¡»ï¼‰     | âœ˜         |
| ç»˜å›¾                                          | âœ˜          | å¯é€‰             | å¯é€‰           | âœ”ï¼ˆæ¨èï¼‰ |
| å‰ç«¯æˆ–æŠ¥å‘Šå±•ç¤º                                | å¯é€‰        | âœ”ï¼ˆå¿…é¡»ï¼‰       | âœ˜             | å¯é€‰       |
| è°ƒè¯• / äººå·¥å®¡é˜…                               | å¯é€‰        | âœ”               | âœ‹ï¼ˆä¸æ¨èï¼‰   | âœ”         |

ä¸€å¥è¯æ€»ç»“ï¼š

> meta.json ç”¨æ¥â€œæ‰¾åˆ°ä¸œè¥¿â€ï¼›
> configs.yaml ç”¨æ¥â€œå†³å®šæ€ä¹ˆåˆ†æâ€ï¼›
> parquet æ˜¯â€œæ•°æ®â€ï¼›
> tsv æ˜¯â€œè§†è§‰ä¸äººå·¥çš„æ¥å£â€ã€‚

### Q&A

#### meta.json æ˜¯ YAML + æ•°æ®æ–‡ä»¶çš„å­é›†å—ï¼Ÿ

å¯¹ï¼Œè€Œä¸”å¿…é¡»æ˜¯å­é›†ã€‚

meta.json çš„è®¾è®¡åŸåˆ™åªæœ‰ä¸€ä¸ªï¼š

> æŠŠ â€œout ç›®å½•æœ€å°ã€æœ€æœ‰ç”¨ã€æœ€å¯å¤ç®—çš„æ‘˜è¦ä¿¡æ¯â€ æ”¾åœ¨ä¸€ä¸ªè·¨è¯­è¨€æœ€å‹å¥½çš„ JSON æ–‡ä»¶é‡Œã€‚
> å®ƒä¸èƒ½åŒ…å«ä»»ä½•æ— æ³•ä» configs.yaml æˆ– info-\*.parquet æ¨å¯¼çš„â€œæ–°çš„ä¸šåŠ¡è¯­ä¹‰â€ã€‚

æ‰€ä»¥ meta.jsonï¼š

- ä¸èƒ½ï¼šæ–°å¢åˆ†æå‚æ•°ã€é˜ˆå€¼ã€TMT æ–¹æ¡ˆã€å¼•æ“ç­–ç•¥
- ä¸èƒ½ï¼šä¿å­˜ YAML é‡Œæ²¡æœ‰çš„é…ç½®æ¥æº
- ä¸èƒ½ï¼šæœ‰ä»»ä½•â€œä¸šåŠ¡å†³ç­–â€

å®ƒåªèƒ½æ˜¯ï¼š

âœ” ç›®å½•ç´¢å¼•
âœ” æ‘˜è¦ï¼ˆæ ·æœ¬æ•°ã€å¯¹æ¯”æ•°ï¼‰
âœ” å¹³å°/é¡¹ç›®çš„å°‘é‡å±•ç¤ºçº§ä¿¡æ¯ï¼ˆå¯ä» YAML å†ç®—å›æ¥ï¼‰

ä¸¥æ ¼æ¥è¯´ï¼š

> meta.json = configs.yaml çš„å¼ºæ‘˜è¦
> ï¼‹ info-samples/contrasts çš„è®¡æ•°çº§æ‘˜è¦
> ï¼‹ out æ–‡ä»¶ç»“æ„çš„ manifestï¼ˆç´¢å¼•ï¼‰

å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªä¸æŸåâ€œå•ä¸€çœŸæºâ€åŸåˆ™çš„ç¼“å­˜/å¿«ç…§ï¼Œä¸æ˜¯æ–°çš„çœŸæºã€‚

#### â€œå•ä¸€çœŸæºâ€ (configs.yaml) ä¸ â€œä¸èƒ½å½“çœŸæºâ€ (meta.json) çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

> configs.yaml æ˜¯â€œçœŸå®ä¸–ç•Œè¯­ä¹‰çš„æ¥æºâ€ã€‚
> meta.json æ˜¯â€œæµç¨‹è¿è¡Œå¿«ç…§ + ç›®å½•ç´¢å¼•â€ã€‚

æ¢æ›´è´´è¿‘ä½ é¡¹ç›®çš„è¯ï¼š

##### configs.yamlï¼ˆçœŸæºï¼‰åŒ…å«â€œè§£é‡Šåˆ†æé€»è¾‘æ‰€éœ€çš„ä¿¡æ¯â€

å®ƒå±äº domain truthï¼ˆä¸šåŠ¡çœŸæºï¼‰ï¼š

- è¿™ä¸ªé¡¹ç›®æ˜¯è°çš„ï¼ˆå®¢æˆ·/é¡¹ç›®ç¼–å·ï¼‰
- å¹³å°æ˜¯ä»€ä¹ˆã€ç‰ˆæœ¬æ˜¯å¤šå°‘
- æ ·æœ¬ç›¸å…³çš„ä¸Šä¸‹æ¸¸é…ç½®
- ç‰©ç§/ reference ä¿¡æ¯
- æœªæ¥ä¼šåŒ…å«åˆ†æå‚æ•°ï¼Œä¾‹å¦‚ï¼š
  - p-value cutoff
  - imputation method
  - normalization method
  - allowed missingness è§„åˆ™

è¿™äº›å†…å®¹ä¼šå½±å“æœ€ç»ˆåˆ†æè¾“å‡ºã€‚
 å› æ­¤ YAML æ˜¯çœŸæºï¼ˆsource of truthï¼‰ã€‚

##### meta.jsonï¼ˆä¸èƒ½å½“çœŸæºï¼‰åªé€‚åˆä¿å­˜ä¸ä¼šæ”¹å˜åˆ†æè¯­ä¹‰çš„ä¿¡æ¯

- run æ—¶é—´
- intake ç‰ˆæœ¬
- æ–‡ä»¶åç´¢å¼•ï¼ˆå‘Šè¯‰ä½ å“ªä»½ parquet æ˜¯æ ·æœ¬ã€å“ªä»½æ˜¯ contrastsï¼‰
- æ ·æœ¬æ•°é‡ã€å¯¹æ¯”æ•°é‡
- å¹³å°/é¡¹ç›®çš„â€œå±•ç¤ºçº§åˆ«æ‘˜è¦â€

è¿™äº›ä¿¡æ¯ åˆ æ‰ meta.json ä»ç„¶å¯ä»¥å®Œæ•´å¤ç®—ã€‚
 å®ƒæ²¡æœ‰ä¸šåŠ¡è¯­ä¹‰ï¼Œä¸å‚ä¸åˆ†æå†³ç­–ï¼Œåªå‚ä¸æµç¨‹ä½¿ç”¨ä½“éªŒã€‚

æ‰€ä»¥ meta.jsonï¼š

- ä¸æ˜¯å‚æ•°è¡¨
- ä¸æ˜¯åˆ†æå®šä¹‰
- ä¸æ˜¯ä¾èµ–æ–‡ä»¶
- ä¸æ˜¯ä¸šåŠ¡çœŸæº
- åªæ˜¯å…¥å£ç´¢å¼•ï¼ˆmanifestï¼‰ï¼‹ å¿«ç…§ï¼ˆsnapshotï¼‰

#### è¿™ä¸ªéœ€æ±‚æ˜¯å¦çœŸå®ï¼Ÿè¿˜æ˜¯ä¼ªéœ€æ±‚ï¼Ÿ

> ä¼šæœ‰å¦ä¸€ä¸ªæ¨¡å—/å¦ä¸€é—¨è¯­è¨€/å‰ç«¯ï¼Œåªæ‹¿åˆ° out ç›®å½•ï¼Œå¸Œæœ›æœ‰ç»Ÿä¸€å…¥å£ã€‚

é‚£ä¹ˆ meta.jsonï¼š

##### âœ” ä¸æ˜¯ä¼ªéœ€æ±‚ï¼›æ˜¯çœŸå®éœ€æ±‚ï¼Œä½†å±äºâ€œæ¥å£éœ€æ±‚â€ï¼Œéä¸šåŠ¡éœ€æ±‚

å®ƒè§£å†³ä¸€ä¸ªç°å®é—®é¢˜ï¼š

> â€œGiven only a path to /out, how do I knowé‡Œé¢æœ‰å“ªäº›æ–‡ä»¶ã€å¹³å°æ˜¯ä»€ä¹ˆã€å¤šå°‘æ ·æœ¬ã€å¤šå°‘å¯¹æ¯”ï¼Ÿâ€

å¦‚æœæ²¡æœ‰ meta.jsonï¼š

- R æ¨¡å—å¿…é¡»çŒœä¿¡æ¯ã€ç¡¬ç¼–ç  file å
- å‰ç«¯å¿…é¡»çŒœ info-samples.tsv åç§°
- Python æ¨¡å—ä¹‹é—´å¿…é¡»å…±äº«å¤æ‚ schema
- ä¸åŒæµç¨‹çš„å…¥å£æ–¹å¼ä¸ç»Ÿä¸€
- out ç›®å½•ä¸å…·å¤‡è‡ªæè¿°æ€§ï¼ˆself-describingï¼‰

å¦‚æœæœ‰ meta.jsonï¼š

- æ‰€æœ‰æ¨¡å—å¯åŠ¨æ–¹å¼ç»Ÿä¸€ï¼š
    load_project("/out") â†’ read meta.json â†’ readå¿…è¦æ–‡ä»¶
- å‰ç«¯ä¸éœ€è¦è§£æ YAMLï¼ˆJSON æ›´å‹å¥½ï¼‰
- è·¨è¯­è¨€å¯ä»¥æ— æŸæ²Ÿé€š
- ä»¥åæ›´æ–°æ–‡ä»¶å‘½åè§„åˆ™ï¼Œä¸éœ€è¦æ›´æ–°æ‰€æœ‰æ¶ˆè´¹è€…

æ‰€ä»¥ meta.json çš„éœ€æ±‚æ¥è‡ªï¼šçœŸå®çš„è·¨æ¨¡å—ã€è·¨è¯­è¨€ã€è·¨å‰ç«¯åä½œåœºæ™¯ï¼Œè€Œä¸æ˜¯ä¸šåŠ¡é€»è¾‘æœ¬èº«ã€‚

#### configs.yamlï¼ˆYAMLï¼‰æœ€ç»ˆåœ¨æ•´ä¸ªç³»ç»Ÿé‡Œæ‰¿æ‹…ä»€ä¹ˆèŒè´£ï¼Ÿ

configs.yaml = å…¨æµç¨‹ä¸­â€œäººç±»å¯è¯»ã€å¯ç¼–è¾‘ã€å¯è§£é‡Šâ€çš„ä¸šåŠ¡é…ç½®çœŸæºã€‚

å®ƒçš„è§’è‰²æ˜¯ï¼š

##### ï¼ˆ1ï¼‰ä¸šåŠ¡è¯­ä¹‰çœŸæºï¼ˆDomain Source of Truthï¼‰

åŒ…æ‹¬ï¼š

- å¹³å°ä¿¡æ¯ â†’ ä¼šå½±å“è¯»å–é€»è¾‘ï¼ˆMQ vs DIA-NNï¼‰
- Fasta / Library â†’ ä¼šå½±å“å®šé‡è§£é‡Š
- TMT reference â†’ ä¼šå½±å“å½’ä¸€åŒ–
- refï¼ˆç‰©ç§ï¼‰â†’ ä¼šå½±å“æ³¨é‡Šé€»è¾‘
- é¡¹ç›®ä¿¡æ¯ â†’ ä¼šå½±å“è½¬äº¤å’Œå®¡è®¡
- æœªæ¥å‚æ•°ï¼ˆé˜ˆå€¼ã€impute ç­–ç•¥ã€QC è§„åˆ™ï¼‰

æ‰€æœ‰åˆ†æè¡Œä¸ºå¿…é¡»ä» YAML æ¨å¯¼ã€‚

##### ï¼ˆ2ï¼‰æ˜¯ç”¨æˆ·å¯æ£€æŸ¥ã€å¯è¿½è¸ªçš„é…ç½®æ–‡ä»¶ï¼ˆHuman-facing fileï¼‰

- JSON ä¸é€‚åˆç»™ç”¨æˆ·ç›´æ¥é˜…è¯»
- YAML å¯ä»¥ä½œä¸ºâ€œåˆ†æé…ç½®æŠ¥å‘Šâ€ä¸€éƒ¨åˆ†
- é¡¹ç›®äº¤ä»˜æ£€æŸ¥ä¹Ÿè¦çœ‹ YAML æ˜¯å¦æ­£ç¡®
- pipeline ç‰ˆæœ¬è¿ç§»æ—¶ YAML æ˜¯æœ€ç¨³å®š anchor

##### ï¼ˆ3ï¼‰æ˜¯æœªæ¥å¤šé¡¹ç›®ã€å¤šç‰ˆæœ¬å…¼å®¹çš„é”šç‚¹

ä»¥åä½ ç‰ˆæœ¬å‡çº§ï¼š

- meta.json å¯ä»¥å˜
- parquet å¯ä»¥å˜
- æ–‡ä»¶å¸ƒå±€å¯ä»¥å˜
- ä½† configs.yaml å¿…é¡»ç¨³å®šã€å¯å…¼å®¹

å› ä¸ºå®ƒæ˜¯ä¸šåŠ¡é…ç½®çš„å”¯ä¸€çœŸæºã€‚

##### æœ€ç»ˆç»Ÿä¸€è§†å›¾

ä¸‰å±‚ç»“æ„ï¼š

```text
1) çœŸæºï¼ˆSource of Truthï¼‰ â†’ configs.yaml
   - æ‰€æœ‰ä¸šåŠ¡å«ä¹‰
   - æ‰€æœ‰åˆ†æå‚æ•°
   - æ‰€æœ‰ platform/ref/project å®ä½“ä¿¡æ¯
   - ä»»ä½•å¯ä»¥å½±å“åˆ†æè¯­ä¹‰çš„ä¸œè¥¿

2) æ•°æ®æ–‡ä»¶ï¼ˆTruth of Dataï¼‰ â†’ info-samples / info-contrasts / expression
   - è¡¨ç»“æ„
   - å®é™…æ ·æœ¬çŸ©é˜µ
   - æ‰€æœ‰å¯è®¡ç®—æ•°æ®

3) ç´¢å¼•ä¸æ‘˜è¦ï¼ˆManifest + Summaryï¼‰ â†’ meta.json
   - å…¥å£ç´¢å¼•
   - æ–‡ä»¶å
   - æ ·æœ¬/å¯¹æ¯”è®¡æ•°
   - run å…ƒä¿¡æ¯
   - éè¯­ä¹‰æ€§æ‘˜è¦ï¼ˆå±•ç¤ºçº§ï¼‰
```

ä¸‰è€…å…³ç³»ï¼š

- meta.json ä» YAML + parquet æ´¾ç”Ÿ
- yaml æ°¸ä¸ä¾èµ– meta.json
- parquet æ°¸ä¸ä¾èµ– meta.json
- meta.json ä»æ¥ä¸èƒ½å½±å“åˆ†æç»“æœ

æ‰€ä»¥ meta.json çš„æœ¬è´¨åœ°ä½æ˜¯ï¼š

> éä¸šåŠ¡æ€§çš„å…¥å£ç´¢å¼•ï¼Œä¸æ˜¯é…ç½®ï¼Œä¸æ˜¯è¯­ä¹‰ï¼Œä¸æ˜¯å‚æ•°ã€‚
